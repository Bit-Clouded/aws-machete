---
platform: linux
inputs:
  - name: ((input))
    path: aws-machete

run:
  path: /bin/sh
  dir: aws-machete
  args:
    - -c
    - |
      set -e
      apk add git
      ln -s $PWD $GOPATH/src
      cd ((build-path))
      go get -d ./...
      go test ./... -v -tags netgo
      go build -tags netgo -o main .
      VERSION=$(head /dev/urandom | tr -dc A-Za-z0-9 | head -c 6 ; echo '')
      ls
      cp main ../../../bin/((bin-name))-${VERSION}

outputs:
  - name: bin
